<Prefab>
  <!-- Lance Panel - Exact copy of native ClansPanel.xml structure -->
  <Constants>

    <Constant Name="Kingdom.Clans.Sort.1.Width" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.1" BrushValueType="Width" />
    <Constant Name="Kingdom.Clans.Sort.1.Height" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.1" BrushValueType="Height" />

    <Constant Name="Kingdom.Clans.Sort.2.Width" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.2" BrushValueType="Width" />
    <Constant Name="Kingdom.Clans.Sort.2.Height" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.2" BrushValueType="Height" />

    <Constant Name="Kingdom.Clans.Sort.3.Width" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.3" BrushValueType="Width" />
    <Constant Name="Kingdom.Clans.Sort.3.Height" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.3" BrushValueType="Height" />

    <Constant Name="Kingdom.Clans.Sort.4.Width" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.4" BrushValueType="Width" />
    <Constant Name="Kingdom.Clans.Sort.4.Height" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.4" BrushValueType="Height" />

    <Constant Name="Kingdom.Clans.Sort.5.Width" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.5" BrushValueType="Width" />
    <Constant Name="Kingdom.Clans.Sort.5.Height" BrushLayer="Default" BrushName="Kingdom.Clans.Sort.5" BrushValueType="Height" />

    <Constant Name="Kingdom.Scroll.Header.Width" BrushLayer="Default" BrushName="Scroll.Header" BrushValueType="Width" />
    <Constant Name="Kingdom.Scroll.Header.Height" BrushLayer="Default" BrushName="Scroll.Header" BrushValueType="Height" />

    <Constant Name="Banner.Width" BrushLayer="Default" BrushName="Flat.Tuple.Banner.Small" BrushValueType="Width" />
    <Constant Name="Banner.Height" BrushLayer="Default" BrushName="Flat.Tuple.Banner.Small" BrushValueType="Height" />

    <Constant Name="Banner.Width.Scaled" MultiplyResult="0.25" Value="!Banner.Width" />
    <Constant Name="Banner.Height.Scaled" MultiplyResult="0.30" Value="!Banner.Height"/>
  </Constants>

  <Window>
    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" IsVisible="@Show">
      <Children>

        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
          <Children>

            <!--Left Panel (Lance Table)-->
            <BrushListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" VerticalAlignment="Bottom" MarginTop="6" MarginBottom="9" MarginLeft="0" Brush="Frame1Brush" StackLayout.LayoutMethod="VerticalBottomToTop">
              <Children>

                <!--Column Headers-->
                <ListPanel Id="SortController" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" RenderLate="true">
                  <Children>

                    <ButtonWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Clans.Sort.1.Width" SuggestedHeight="!Kingdom.Clans.Sort.1.Height" Brush="Kingdom.Clans.Sort.1">
                      <Children>
                        <TextWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.SortButtons.Text" Text="@BannerText" />
                      </Children>
                    </ButtonWidget>

                    <ButtonWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Clans.Sort.2.Width" SuggestedHeight="!Kingdom.Clans.Sort.2.Height" Brush="Kingdom.Clans.Sort.2">
                      <Children>
                        <TextWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.SortButtons.Text" Text="@TypeText" />
                      </Children>
                    </ButtonWidget>

                    <ButtonWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Clans.Sort.3.Width" SuggestedHeight="!Kingdom.Clans.Sort.3.Height" Brush="Kingdom.Clans.Sort.3">
                      <Children>
                        <TextWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.SortButtons.Text" Text="@NameText" />
                      </Children>
                    </ButtonWidget>

                    <ButtonWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Clans.Sort.4.Width" SuggestedHeight="!Kingdom.Clans.Sort.4.Height" Brush="Kingdom.Clans.Sort.4">
                      <Children>
                        <TextWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.SortButtons.Text" Text="@MembersText" />
                      </Children>
                    </ButtonWidget>

                    <ButtonWidget DoNotAcceptEvents="true" DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Clans.Sort.5.Width" SuggestedHeight="!Kingdom.Clans.Sort.5.Height" Brush="Kingdom.Clans.Sort.5">
                      <Children>
                        <TextWidget DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.SortButtons.Text" Text="@FallenText" />
                      </Children>
                    </ButtonWidget>

                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Kingdom.Scroll.Header.Width" SuggestedHeight="!Kingdom.Scroll.Header.Height" Sprite="StdAssets\scroll_header" ExtendRight="3" ExtendTop="6" ExtendLeft="3" ExtendBottom="4" HorizontalAlignment="Right" />

                  </Children>
                </ListPanel>

                <!--List and Scrollbar-->
                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent">
                  <Children>
                    
                    <!--Lance List Scrollable Panel-->
                    <ScrollablePanel WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" MarginLeft="3" MarginBottom="3" AutoHideScrollBars="true" ClipRect="LanceListClipRect" InnerPanel="LanceListClipRect\LanceList" VerticalScrollbar="..\LancesListScrollbar\Scrollbar">
                      <Children>

                        <Widget Id="LanceListClipRect" WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" ClipContents="true">
                          <Children>
                            <ListPanel Id="LanceList" DataSource="{Lances}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop">
                              <ItemTemplate>
                                <LanceTuple />
                              </ItemTemplate>
                            </ListPanel>
                          </Children>
                        </Widget>

                      </Children>
                    </ScrollablePanel>

                    <Standard.VerticalScrollbar Id="LancesListScrollbar" HeightSizePolicy="StretchToParent" HorizontalAlignment="Right" MarginRight="2" MarginLeft="2" MarginBottom="3" />
                  </Children>
                </ListPanel>

              </Children>
            </BrushListPanel>

            <!--Right Side (Members Display)-->
            <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
              <Children>

                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="540" SuggestedHeight="923" HorizontalAlignment="Right" VerticalAlignment="Bottom" PositionYOffset="80" Sprite="SPGeneral\background_illustration_clans" AlphaFactor="0.7" />

                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" IsVisible="@HasSelectedLance">
                  <Children>
                    
                    <!--Lance Name-->
                    <TextWidget DataSource="{SelectedLance}" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="1000" SuggestedHeight="45" HorizontalAlignment="Center" Brush="Kingdom.TitleMedium.Text" Text="@Name" ClipContents="false" />

                    <!--Banner-->
                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="107" SuggestedHeight="128" MarginTop="5" HorizontalAlignment="Center" VerticalAlignment="Top">
                      <Children>
                        <MaskedTextureWidget DataSource="{SelectedLance\Banner_9}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Kingdom.TornBanner.Big" AdditionalArgs="@AdditionalArgs" ImageId="@Id" TextureProviderName="@TextureProviderName" />
                      </Children>
                    </Widget>

                    <!--Lance Status Panel-->
                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="500" MarginTop="15" MarginBottom="10" HorizontalAlignment="Center">
                      <Children>
                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop">
                          <Children>
                            
                            <!--Status Header-->
                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="18" Text="Lance Status" HorizontalAlignment="Center" MarginBottom="8"/>
                            
                            <!--Readiness Bar-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="22" MarginBottom="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                              <Children>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="Readiness" VerticalAlignment="Center"/>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="300" SuggestedHeight="16" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#333333FF">
                                  <Children>
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="@NeedReadinessBar" MaxWidth="300" Sprite="BlankWhiteSquare_9" Color="@NeedReadinessColor" HorizontalAlignment="Left"/>
                                  </Children>
                                </Widget>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="80" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@NeedReadinessText" VerticalAlignment="Center" HorizontalAlignment="Right" MarginLeft="10"/>
                              </Children>
                            </ListPanel>
                            
                            <!--Equipment Bar-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="22" MarginBottom="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                              <Children>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="Equipment" VerticalAlignment="Center"/>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="300" SuggestedHeight="16" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#333333FF">
                                  <Children>
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="@NeedEquipmentBar" MaxWidth="300" Sprite="BlankWhiteSquare_9" Color="@NeedEquipmentColor" HorizontalAlignment="Left"/>
                                  </Children>
                                </Widget>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="80" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@NeedEquipmentText" VerticalAlignment="Center" HorizontalAlignment="Right" MarginLeft="10"/>
                              </Children>
                            </ListPanel>
                            
                            <!--Morale Bar-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="22" MarginBottom="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                              <Children>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="Morale" VerticalAlignment="Center"/>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="300" SuggestedHeight="16" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#333333FF">
                                  <Children>
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="@NeedMoraleBar" MaxWidth="300" Sprite="BlankWhiteSquare_9" Color="@NeedMoraleColor" HorizontalAlignment="Left"/>
                                  </Children>
                                </Widget>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="80" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@NeedMoraleText" VerticalAlignment="Center" HorizontalAlignment="Right" MarginLeft="10"/>
                              </Children>
                            </ListPanel>
                            
                            <!--Rest Bar-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="22" MarginBottom="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                              <Children>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="Rest" VerticalAlignment="Center"/>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="300" SuggestedHeight="16" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#333333FF">
                                  <Children>
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="@NeedRestBar" MaxWidth="300" Sprite="BlankWhiteSquare_9" Color="@NeedRestColor" HorizontalAlignment="Left"/>
                                  </Children>
                                </Widget>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="80" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@NeedRestText" VerticalAlignment="Center" HorizontalAlignment="Right" MarginLeft="10"/>
                              </Children>
                            </ListPanel>
                            
                            <!--Supplies Bar-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="22" MarginBottom="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                              <Children>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="Supplies" VerticalAlignment="Center"/>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="300" SuggestedHeight="16" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#333333FF">
                                  <Children>
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="@NeedSuppliesBar" MaxWidth="300" Sprite="BlankWhiteSquare_9" Color="@NeedSuppliesColor" HorizontalAlignment="Left"/>
                                  </Children>
                                </Widget>
                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="80" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@NeedSuppliesText" VerticalAlignment="Center" HorizontalAlignment="Right" MarginLeft="10"/>
                              </Children>
                            </ListPanel>
                            
                          </Children>
                        </ListPanel>
                      </Children>
                    </Widget>

                    <ListPanel UpdateChildrenStates="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight">
                      <Children>

                        <!--Members Panel-->
                        <ListPanel Id="MembersList" UpdateChildrenStates="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop">
                          <Children>

                            <!--Divider-->
                            <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" UpdateChildrenStates="true" DoNotPassEventsToChildren="true" MarginRight="30" MarginLeft="30">
                              <Children>
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Text="@MembersHeaderText" Brush="Kingdom.TitleMedium.Text" Brush.FontSize="32" MarginLeft="5" VerticalAlignment="Center" />
                                <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="2" MarginLeft="10" VerticalAlignment="Bottom" MarginBottom="10" Sprite="GradientDivider_9" AlphaFactor="0.4" />
                              </Children>
                            </ListPanel>

                            <!--Members Grid (like native clan members)-->
                            <ListPanel UpdateChildrenStates="true" WidthSizePolicy="CoverChildren" HeightSizePolicy="Fixed" SuggestedHeight="440" HorizontalAlignment="Left" MarginLeft="32">
                              <Children>
                                <ScrollablePanel UpdateChildrenStates="true" WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" MarginLeft="3" MarginBottom="3" AutoHideScrollBars="true" ClipRect="MembersGridWidgetClipRect" InnerPanel="MembersGridWidgetClipRect\MembersGridWidget" VerticalScrollbar="..\VerticalScrollbar">
                                  <Children>
                                    <Widget Id="MembersGridWidgetClipRect" WidthSizePolicy="CoverChildren" HeightSizePolicy="StretchToParent" ClipContents="true">
                                      <Children>
                                        <GridWidget Id="MembersGridWidget" DataSource="{SelectedLance\Members}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" SuggestedWidth="350" SuggestedHeight="350" DefaultCellWidth="100" DefaultCellHeight="130" HorizontalAlignment="Center" ColumnCount="6" LayoutIrregularCells="false">
                                          <ItemTemplate>
                                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="90" SuggestedHeight="130" Brush.ValueFactor="-50" ClipContents="false">
                                              <Children>
                                                <!-- Hero portrait (black silhouette placeholder) -->
                                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="85" SuggestedHeight="85" HorizontalAlignment="Center" VerticalAlignment="Top">
                                                  <Children>
                                                    <!-- Background frame -->
                                                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Sprite="SPGeneral\FrameSmallShield" Color="#3B3228FF" />
                                                    <!-- Black silhouette portrait (undiscovered) -->
                                                    <ImageIdentifierWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ImageTypeCode="1" Id="-1" AdditionalArgs="0" />
                                                  </Children>
                                                </Widget>
                                                
                                                <!-- Name and Rank below portrait -->
                                                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Top" PositionYOffset="88" StackLayout.LayoutMethod="VerticalBottomToTop">
                                                  <Children>
                                                    <!-- Rank (bottom) -->
                                                    <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="14" Text="@Rank" ClipContents="false" Brush.TextColor="#B89968FF"/>
                                                    <!-- Name (top) -->
                                                    <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="Kingdom.ParagraphSmall.Text" Brush.FontSize="16" Text="@Name" ClipContents="false"/>
                                                  </Children>
                                                </ListPanel>
                                              </Children>
                                            </Widget>
                                          </ItemTemplate>
                                        </GridWidget>
                                      </Children>
                                    </Widget>
                                  </Children>
                                </ScrollablePanel>
                                <Standard.VerticalScrollbar Id="VerticalScrollbar" HeightSizePolicy="StretchToParent" HorizontalAlignment="Right" MarginRight="2" MarginLeft="2" MarginBottom="3" />
                              </Children>
                            </ListPanel>

                          </Children>
                        </ListPanel>

                      </Children>
                    </ListPanel>

                  </Children>
                </ListPanel>

              </Children>
            </Widget>

          </Children>
        </ListPanel>

      </Children>
    </Widget>
  </Window>
</Prefab>
