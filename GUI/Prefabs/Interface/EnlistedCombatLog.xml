<Prefab>
  <Window>
    <!-- Main Container - mimics native SPChatLog structure -->
    <Widget Id="EnlistedCombatLogWidget" 
            DoNotAcceptEvents="false" 
            WidthSizePolicy="Fixed" 
            HeightSizePolicy="Fixed"
            SuggestedWidth="400" 
            SuggestedHeight="280"
            HorizontalAlignment="Right" 
            VerticalAlignment="Bottom"
            MarginRight="30"
            PositionYOffset="@PositionYOffset"
            IsVisible="@IsVisible"
            AlphaFactor="@ContainerAlpha"
            Command.HoverBegin="OnUserInteraction"
            Command.MouseScroll="OnUserInteraction">
      <Children>
        
        <!-- Scrollable Panel Container (always visible, like native) -->
        <Widget Id="ScrollablePanelContainer" 
                WidthSizePolicy="StretchToParent" 
                HeightSizePolicy="StretchToParent" 
                HorizontalAlignment="Right" 
                VerticalAlignment="Bottom"
                DoNotAcceptEvents="false">
          <Children>
            
            <!-- Scrollable Panel (mimics native scrolling structure) -->
            <ScrollablePanel Id="ScrollablePanel" 
                            DoNotAcceptEvents="false"
                            WidthSizePolicy="StretchToParent" 
                            HeightSizePolicy="StretchToParent"
                            VerticalAlignment="Bottom"
                            ClipRect="ClipRect" 
                            InnerPanel="ClipRect\InnerPanel" 
                            VerticalScrollbar="..\ScrollbarHolder\VerticalScrollbar">
              <Children>
                
                <!-- Clip Rectangle (clips content like native) -->
                <Widget Id="ClipRect" 
                        DoNotAcceptEvents="false"
                        ClipContents="true" 
                        WidthSizePolicy="StretchToParent" 
                        HeightSizePolicy="StretchToParent" 
                        MarginLeft="15" 
                        MarginRight="21">
                  <Children>
                    
                    <!-- Message List Panel (Bottom to Top like native) -->
                    <ListPanel Id="InnerPanel" 
                              DataSource="{Messages}" 
                              DoNotAcceptEvents="false" 
                              WidthSizePolicy="StretchToParent" 
                              HeightSizePolicy="CoverChildren" 
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Bottom" 
                              ClipContents="true" 
                              StackLayout.LayoutMethod="VerticalBottomToTop">
                      <ItemTemplate>
                        
                        <!-- Individual Message (mimics native ChatLogItemWidget) -->
                        <Widget DoNotAcceptEvents="false" 
                                WidthSizePolicy="StretchToParent" 
                                HeightSizePolicy="CoverChildren">
                          <Children>
                            
                            <!-- Message Text with Encyclopedia Link Support -->
                            <RichTextWidget Id="MessageTextWidget"
                                          DoNotAcceptEvents="false" 
                                          WidthSizePolicy="StretchToParent" 
                                          HeightSizePolicy="CoverChildren" 
                                          Text="@Text"
                                          MarginLeft="5" 
                                          MarginRight="5" 
                                          Brush="Enlisted.CombatLog.Text" 
                                          Brush.GlobalAlphaFactor="@AlphaFactor" 
                                          Brush.TextHorizontalAlignment="Left" 
                                          Brush.TextVerticalAlignment="Center" 
                                          ClipContents="false" />
                            
                          </Children>
                        </Widget>
                        
                      </ItemTemplate>
                    </ListPanel>
                    
                  </Children>
                </Widget>
                
              </Children>
            </ScrollablePanel>
            
            <!-- Scrollbar Holder (only shown if needed, like native) -->
            <Widget Id="ScrollbarHolder" 
                    WidthSizePolicy="CoverChildren" 
                    HeightSizePolicy="StretchToParent" 
                    HorizontalAlignment="Right">
              <Children>
                
                <!-- Vertical Scrollbar (mimics native style) -->
                <ScrollbarWidget Id="VerticalScrollbar" 
                                WidthSizePolicy="CoverChildren" 
                                HeightSizePolicy="StretchToParent" 
                                AlignmentAxis="Vertical" 
                                Handle="VerticalScrollbarHandle" 
                                MarginTop="5" 
                                MarginBottom="5" 
                                MaxValue="100" 
                                MinValue="0">
                  <Children>
                    <!-- Scrollbar Track -->
                    <Widget WidthSizePolicy="Fixed" 
                            HeightSizePolicy="StretchToParent" 
                            SuggestedWidth="2" 
                            HorizontalAlignment="Center" 
                            Sprite="BlankWhiteSquare_9" 
                            Color="#A37434FF" 
                            MarginTop="5" 
                            MarginBottom="5" 
                            AlphaFactor="0.7" />
                    
                    <!-- Scrollbar Handle (mimics native brush) -->
                    <ImageWidget Id="VerticalScrollbarHandle" 
                                WidthSizePolicy="Fixed" 
                                HeightSizePolicy="Fixed" 
                                MinHeight="15" 
                                SuggestedHeight="10" 
                                SuggestedWidth="14" 
                                HorizontalAlignment="Center" 
                                Brush="SPChatlog.Scrollbar.Handle" />
                  </Children>
                </ScrollbarWidget>
                
              </Children>
            </Widget>
            
          </Children>
        </Widget>
        
      </Children>
    </Widget>
  </Window>
</Prefab>
