<Prefab>
	<Window>
		<!-- Full screen overlay for upgrade interface -->
		<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center">
			<Children>
				<!-- Dark background overlay -->
				<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Background.Medium" />
				
				<!-- Main upgrade container -->
				<Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="900" SuggestedHeight="700" HorizontalAlignment="Center" VerticalAlignment="Center">
					<Children>
						<!-- Background panel -->
						<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Encyclopedia.SubPage.Background" />
						
						<!-- Header section -->
						<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="80" VerticalAlignment="Top">
							<Children>
								<!-- Title bar background -->
								<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Encyclopedia.SubPage.Element" />
								
								<!-- Title text -->
								<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Recruitment.Popup.Title.Text" Brush.FontSize="22" Text="@HeaderText" />
								
								<!-- Player gold display (top right) -->
								<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Right" VerticalAlignment="Center" MarginRight="20" Brush="SPGeneral.MediumText" Brush.FontSize="16" Text="@PlayerGoldText" />
							</Children>
						</Widget>
						
						<!-- Content section - scrollable list of upgradeable items -->
						<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="550" VerticalAlignment="Top" MarginTop="90" MarginLeft="20" MarginRight="20">
							<Children>
								<!-- Scroll panel for upgradeable items -->
								<ScrollablePanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" InnerPanel="UpgradeItemsContainer" IsVisible="@HasUpgradeableItems">
									<Children>
										<Widget Id="UpgradeItemsContainer" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren">
											<Children>
												<!-- List of upgradeable items -->
												<ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" DataSource="{UpgradeableItems}" StackLayout.LayoutMethod="VerticalBottomToTop" MarginTop="10" MarginBottom="10">
													<ItemTemplate>
														<Widget>
															<Children>
																<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginBottom="20">
																	<Children>
																		<!-- Upgrade item card -->
																		<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="Encyclopedia.SubPage.Element">
																			<Children>
																				<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginLeft="15" MarginRight="15" MarginTop="15" MarginBottom="15">
																					<Children>
																						<!-- Item info section (left side) -->
																						<Widget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="250" HorizontalAlignment="Left">
																							<Children>
																								<!-- Item image -->
																								<Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="100" SuggestedHeight="70" HorizontalAlignment="Left" VerticalAlignment="Top">
																									<Children>
																										<ImageIdentifierWidget DataSource="{Image}" DoNotAcceptEvents="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ImageId="@Id" AdditionalArgs="@AdditionalArgs" TextureProviderName="@TextureProviderName" />
																									</Children>
																								</Widget>
																								
																								<!-- Item name and slot -->
																								<Widget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="140" HorizontalAlignment="Left" MarginLeft="110" MarginTop="5">
																									<Children>
																										<RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="Recruitment.Popup.Title.Text" Brush.FontSize="16" Text="@ItemName" />
																										<RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="25" Brush="SPGeneral.SmallText" Brush.FontSize="12" Text="@SlotTypeText" />
																									</Children>
																								</Widget>
																								
																								<!-- Current quality display -->
																								<Widget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="220" HorizontalAlignment="Left" MarginTop="75">
																									<Children>
																										<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="SPGeneral.SmallText" Brush.FontSize="12" Text="{=qm_upgrade_current}Current:" />
																										<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginLeft="65" Brush="SPGeneral.MediumText" Brush.FontSize="14" Brush.TextColor="@CurrentQualityColor" Text="@CurrentQualityText" />
																									</Children>
																								</Widget>
																							</Children>
																						</Widget>
																						
																						<!-- Upgrade options section (right side) -->
																						<Widget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="550" HorizontalAlignment="Right">
																							<Children>
																								<!-- Upgrade options available -->
																								<Widget IsVisible="@HasUpgrades" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren">
																									<Children>
																										<!-- Label -->
																										<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" Brush="SPGeneral.MediumText" Brush.FontSize="13" Text="{=qm_upgrade_available}Available Upgrades:" />
																										
																										<!-- List of upgrade tier options -->
																										<ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" DataSource="{UpgradeOptions}" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginTop="30" MarginLeft="10">
																											<ItemTemplate>
																												<Widget>
																													<Children>
																														<!-- Individual upgrade option card -->
																														<Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="160" SuggestedHeight="110" MarginRight="15">
																															<Children>
																																<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Encyclopedia.SubPage.Element.Darker" />
																																
																																<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="10" MarginRight="10" MarginTop="10" MarginBottom="10">
																																	<Children>
																																		<!-- Quality tier name -->
																																		<RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="Recruitment.Popup.Title.Text" Brush.FontSize="15" Brush.TextColor="@QualityColor" Text="@QualityText" />
																																		
																																		<!-- Cost -->
																																		<RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="30" Brush="SPGeneral.MediumText" Brush.FontSize="13" Text="@CostText" />
																																		
																																		<!-- Upgrade button -->
																																		<ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="35" SuggestedWidth="130" HorizontalAlignment="Center" VerticalAlignment="Bottom" Brush="ButtonBrush1" Command.Click="ExecuteUpgrade" IsEnabled="@IsEnabled">
																																			<Children>
																																				<RichTextWidget DoNotAcceptEvents="true" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="OverlayPopup.ButtonText" Brush.FontSize="13" Text="{=qm_upgrade_btn}Improve" />
																																			</Children>
																																		</ButtonWidget>
																																	</Children>
																																</Widget>
																															</Children>
																														</Widget>
																													</Children>
																												</Widget>
																											</ItemTemplate>
																										</ListPanel>
																									</Children>
																								</Widget>
																								
																								<!-- No upgrades available message -->
																								<Widget IsVisible="@HasUpgrades" IsVisible.Invert="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="50">
																									<Children>
																										<RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="SPGeneral.SmallText" Brush.FontSize="12" Text="@NoUpgradeReason" />
																									</Children>
																								</Widget>
																							</Children>
																						</Widget>
																					</Children>
																				</Widget>
																			</Children>
																		</BrushWidget>
																	</Children>
																</Widget>
															</Children>
														</Widget>
													</ItemTemplate>
												</ListPanel>
											</Children>
										</Widget>
									</Children>
								</ScrollablePanel>
								
								<!-- No upgradeable items message -->
								<Widget IsVisible="@HasUpgradeableItems" IsVisible.Invert="true" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
									<Children>
										<RichTextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Recruitment.Popup.Description.Text" Brush.FontSize="18" Text="@NoItemsMessage" />
									</Children>
								</Widget>
							</Children>
						</Widget>
						
						<!-- Footer section with close button -->
						<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="60" VerticalAlignment="Bottom" MarginBottom="10">
							<Children>
								<!-- Close button -->
								<ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="45" SuggestedWidth="150" HorizontalAlignment="Center" Brush="ButtonBrush1" Command.Click="ExecuteClose">
									<Children>
										<RichTextWidget DoNotAcceptEvents="true" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="OverlayPopup.ButtonText" Brush.FontSize="16" Text="{=str_done}Done" />
									</Children>
								</ButtonWidget>
							</Children>
						</Widget>
					</Children>
				</Widget>
			</Children>
		</Widget>
	</Window>
</Prefab>

