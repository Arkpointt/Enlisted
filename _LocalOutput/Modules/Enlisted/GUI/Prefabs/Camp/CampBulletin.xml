<Prefab>
  <!-- Settlement management inspired layout (mirrors Modules/SandBox/GUI/Prefabs/TownManagement/TownManagement.xml) -->
  <Constants>
    <Constant Name="Encyclopedia.Frame.Width" BrushLayer="Default" BrushName="Encyclopedia.Frame" BrushValueType="Width" />
    <Constant Name="Encyclopedia.Frame.Height" BrushLayer="Default" BrushName="Encyclopedia.Frame" BrushValueType="Height" />

    <Constant Name="Top.Height" Value="220" />
    <Constant Name="Top.VerticalDivider.Height" Value="!Top.Height" />
    <Constant Name="Top.VerticalDivider.Width" Value="15" />
    <Constant Name="Top.VerticalDivider.Thin.Width" Value="7" />
  </Constants>
  <Window>
    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Sprite="BlankWhiteSquare_9" Color="#000000CC">
      <Children>

        <!-- Native-style close button (same as TownManagement) -->
        <Standard.PopupCloseButton HorizontalAlignment="Center" VerticalAlignment="Center" MarginTop="940" Parameter.ButtonAction="ExecuteDone" Parameter.ButtonText="@DoneText" Parameter.InputKeyDataSource="{DoneInputKey}" />

        <!-- Popup frame -->
        <BrushWidget Id="CampBulletinPopup" DoNotAcceptEvents="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Encyclopedia.Frame.Width" SuggestedHeight="!Encyclopedia.Frame.Height" HorizontalAlignment="Center" VerticalAlignment="Center" MarginBottom="35" Brush="Encyclopedia.Frame">
          <Children>

            <!-- Title bar -->
            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="590" SuggestedHeight="155" HorizontalAlignment="Center" VerticalAlignment="Top" PositionXOffset="6" PositionYOffset="-18" Sprite="StdAssets\tabbar_popup" IsDisabled="true">
              <Children>
                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" PositionYOffset="-25" Brush="Recruitment.Popup.Title.Text" Brush.FontSize="46" IsDisabled="true" Text="@TitleText" />
              </Children>
            </Widget>

            <!-- Top row: locations (shop-like icons) + center "Reports" button -->
            <!-- Lift this slightly so the buttons visually overlap the menu area like native TownManagement -->
            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginLeft="35" MarginTop="50" PositionYOffset="-10" StackLayout.LayoutMethod="VerticalBottomToTop">
              <Children>
                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="6" ClipContents="false" Text="@LocationsText" />

                <NavigatableListPanel Id="CampLocationList" DataSource="{Locations}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginRight="10" MarginTop="10" MarginBottom="10">
                  <ItemTemplate>
                    <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="90" SuggestedHeight="65" MarginLeft="5" MarginRight="5" MarginTop="5" MarginBottom="5" Command.Click="ExecuteSelect" HoverText="@HintText">
                      <Children>
                        <!-- Selection outline (cold color) -->
                        <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" DoNotAcceptEvents="true">
                          <Children>
                            <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" IsVisible="@IsSelected" Sprite="BlankWhiteSquare_9" Color="#66CCFFFF" />
                            <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="2" MarginRight="2" MarginTop="2" MarginBottom="2" Brush="Encyclopedia.SubPage.Element" DoNotAcceptEvents="true">
                              <Children>
                                <!-- Phase 3: Use sprite icon instead of text -->
                                <ImageWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="48" SuggestedHeight="48" HorizontalAlignment="Center" VerticalAlignment="Center" Sprite="@IconSprite" />
                              </Children>
                            </BrushWidget>
                          </Children>
                        </Widget>
                      </Children>
                    </ButtonWidget>
                  </ItemTemplate>
                </NavigatableListPanel>
              </Children>
            </ListPanel>

            <ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="58.5" SuggestedHeight="68.5" HorizontalAlignment="Center" MarginTop="90" Command.Click="ExecuteShowBulletin" DoNotPassEventsToChildren="true">
              <Children>
                <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Sprite="SPGeneral\TownManagement\Consumption_Icon" DoNotAcceptEvents="true" />
              </Children>
            </ButtonWidget>

            <!-- Inner panel (content area) -->
            <Widget Id="InnerPanel" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="20" MarginRight="18" MarginTop="172" MarginBottom="25">
              <Children>

                <!-- TOP STATUS STRIP (TownManagement-like stats at the top) -->
                <!-- Top stats: drop text down slightly to match native spacing -->
                <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="82" VerticalAlignment="Top" MarginTop="6">
                  <Children>
                    <Widget DataSource="{PlayerStatus}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                      <Children>
                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" StackLayout.LayoutMethod="HorizontalLeftToRight">
                          <Children>
                            <!-- Left third -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="520" HorizontalAlignment="Center">
                              <Children>
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@FatigueText" />
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="26" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@HeatText" />
                              </Children>
                            </Widget>
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="!Top.VerticalDivider.Thin.Width" Sprite="SPGeneral\TownManagement\vertical_divider" AlphaFactor="0.44" />
                            <!-- Middle third -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="520" HorizontalAlignment="Center">
                              <Children>
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@FoodText" />
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="26" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@ReputationText" />
                              </Children>
                            </Widget>
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="!Top.VerticalDivider.Thin.Width" Sprite="SPGeneral\TownManagement\vertical_divider" AlphaFactor="0.44" />
                            <!-- Right third (Time) -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="520" HorizontalAlignment="Center">
                              <Children>
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@CurrentTimeFullText" />
                              </Children>
                            </Widget>
                          </Children>
                        </ListPanel>
                      </Children>
                    </Widget>
                  </Children>
                </Widget>

                <!-- Horizontal divider (matches TownManagement) -->
                <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="14" VerticalAlignment="Top" MarginTop="68" Sprite="SPGeneral\TownManagement\horizontal_divider" />

                <!-- MAIN CONTENT AREA (matches native TopHalf + BottomHalf structure) -->
                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="96" StackLayout.LayoutMethod="VerticalBottomToTop">
                  <Children>

                    <!-- TOP TIER: Reserve/Incoming Pay (matches native Reserve in TopHalf) -->
                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="!Top.Height">
                      <Children>
                        <!-- LEFT BOX: Dispatch board (fills the previously empty top-left area). -->
                        <!-- Uses the same ScrollablePanel + ScrollbarWidget wiring pattern as the native Encyclopedia. -->
                        <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="5" MarginLeft="15" MarginRight="430">
                          <Children>
                            <ScrollablePanel Id="CampDispatchScrollable" HeightSizePolicy="StretchToParent" WidthSizePolicy="StretchToParent" InnerPanel="CampDispatchRect\CampDispatchInner" ClipRect="CampDispatchRect" MouseScrollAxis="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center" VerticalScrollbar="..\CampDispatchScrollbar" AutoHideScrollBars="true">
                              <Children>
                                <Widget Id="CampDispatchRect" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
                                  <Children>
                                    <ListPanel Id="CampDispatchInner" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom" MarginRight="10">
                                      <Children>
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="TownManagement.Item.Title.Text" Brush.FontSize="18" Text="Dispatch Board" Brush.FontColor="#f4e1c4ff" />
                                        <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="520" SuggestedHeight="7" HorizontalAlignment="Left" Sprite="SPGeneral\TownManagement\title_divider" />

                                        <!-- Lance / schedule headlines -->
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="6" MarginBottom="4" Brush="TownManagement.Description.Title.Text" Brush.FontSize="15" Text="Lance News" />
                                        <ListPanel DataSource="{LanceNews}" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom" MarginBottom="8">
                                          <ItemTemplate>
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginBottom="2" Brush="TownManagement.Description.Value.Text" Brush.FontSize="13" Text="@Title" />
                                          </ItemTemplate>
                                        </ListPanel>

                                        <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="520" SuggestedHeight="7" HorizontalAlignment="Left" Sprite="SPGeneral\TownManagement\title_divider" AlphaFactor="0.55" />

                                        <!-- Kingdom event headlines -->
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="6" MarginBottom="4" Brush="TownManagement.Description.Title.Text" Brush.FontSize="15" Text="Kingdom Dispatches" />
                                        <ListPanel DataSource="{KingdomDispatches}" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom">
                                          <ItemTemplate>
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginBottom="2" Brush="TownManagement.Description.Value.Text" Brush.FontSize="13" Text="@Title" />
                                          </ItemTemplate>
                                        </ListPanel>
                                      </Children>
                                    </ListPanel>
                                  </Children>
                                </Widget>
                              </Children>
                            </ScrollablePanel>

                            <!-- Scrollbar (Encyclopedia-style) -->
                            <ScrollbarWidget HeightSizePolicy="StretchToParent" WidthSizePolicy="Fixed" Id="CampDispatchScrollbar" SuggestedWidth="30" MinValue="0" MaxValue="100" AlignmentAxis="Vertical" HorizontalAlignment="Right" VerticalAlignment="Center" Handle="CampDispatchScrollbarHandle" MarginRight="2">
                              <Children>
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="4" HorizontalAlignment="Center" Sprite="SPGeneral\SPRecruitment\slider_thin_bed_vertical" />
                                <ImageWidget Id="CampDispatchScrollbarHandle" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" MinHeight="60" SuggestedWidth="30" SuggestedHeight="90" HorizontalAlignment="Center" Brush="Encyclopedia.Scroll.Handle.Vertical" />
                              </Children>
                            </ScrollbarWidget>
                          </Children>
                        </Widget>

                        <!-- Right-aligned incoming pay panel (native Reserve position) -->
                        <Widget DataSource="{PlayerStatus}" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="413" HorizontalAlignment="Right" MarginTop="5">
                          <Children>
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Top.VerticalDivider.Width" SuggestedHeight="!Top.VerticalDivider.Height" HorizontalAlignment="Left" VerticalAlignment="Bottom" Sprite="SPGeneral\TownManagement\vertical_divider" AlphaFactor="0.5" />

                            <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Top" StackLayout.LayoutMethod="VerticalBottomToTop">
                              <Children>
                                <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Item.Title.Text" Text="@IncomingPayTitleText" Brush.FontColor="#f4e1c4ff" />
                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="341" SuggestedHeight="7" HorizontalAlignment="Center" Sprite="SPGeneral\TownManagement\title_divider" />

                                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="4" StackLayout.LayoutMethod="HorizontalLeftToRight">
                                  <Children>
                                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="TownManagement.ReserveAmount.Text" IntText="@IncomingPayAmount" />
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="40" SuggestedHeight="40" HorizontalAlignment="Center" VerticalAlignment="Center" MarginLeft="2" Sprite="General\Icons\Coin@2x" />
                                  </Children>
                                </ListPanel>

                                <TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="350" SuggestedHeight="50" HorizontalAlignment="Center" Brush="TownManagement.Income.Item.Text" Brush.FontSize="20" MarginBottom="0" MarginTop="4" Text="@IncomingPaySubText" />
                              </Children>
                            </ListPanel>
                          </Children>
                        </Widget>

                        <!-- Horizontal divider below top tier -->
                        <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="14" VerticalAlignment="Bottom" PositionYOffset="7" Sprite="SPGeneral\TownManagement\horizontal_divider" />
                      </Children>
                    </Widget>

                    <!-- BOTTOM TIER: Three columns (Lance Leader | Bulletin/Activities | Details + Queue) -->
                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                      <Children>
                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                          <Children>

                            <!-- LEFT PANEL: Lance leader -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="340">
                              <Children>
                                <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Top" StackLayout.LayoutMethod="VerticalBottomToTop">
                                  <Children>
                                    <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Item.Title.Text" Text="Lance Leader" Brush.FontColor="#f4e1c4ff" />
                                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="341" SuggestedHeight="7" Sprite="SPGeneral\TownManagement\title_divider" />

                                    <Widget DataSource="{LanceLeader}" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="10">
                                      <Children>
                                        <!-- Governor-style portrait box -->
                                        <ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="160" SuggestedHeight="120" HorizontalAlignment="Center" Command.Click="ExecuteShowLanceInfo" DoNotPassEventsToChildren="true">
                                          <Children>
                                            <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="TownManagement.Governor" DoNotAcceptEvents="true">
                                              <Children>
                                                <ImageIdentifierWidget DataSource="{Hero\\ImageIdentifier}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" MarginLeft="3" MarginRight="3" MarginTop="3" MarginBottom="3" ImageId="@Id" TextureProviderName="@TextureProviderName" />
                                              </Children>
                                            </BrushWidget>
                                          </Children>
                                        </ButtonWidget>

                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="128" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@TitleText" />
                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="154" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@PartySizeText" />

                                        <ButtonWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="200" SuggestedHeight="42" HorizontalAlignment="Center" MarginTop="186" Command.Click="ExecuteShowLanceInfo" DoNotPassEventsToChildren="true">
                                          <Children>
                                            <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Button.ItemCard.Primary" DoNotAcceptEvents="true">
                                              <Children>
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Popup.Button.ItemCard.Primary.Text" Brush.FontSize="18" Text="Party Info" />
                                              </Children>
                                            </BrushWidget>
                                          </Children>
                                        </ButtonWidget>
                                      </Children>
                                    </Widget>
                                  </Children>
                                </ListPanel>

                                <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="!Top.VerticalDivider.Width" SuggestedHeight="!Top.VerticalDivider.Height" HorizontalAlignment="Right" VerticalAlignment="Center" Sprite="SPGeneral\TownManagement\vertical_divider" AlphaFactor="0.5" />
                              </Children>
                            </Widget>

                    <!-- CENTER PANEL: bulletin / activities -->
                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="350" MarginRight="450">
                      <Children>
                        <!-- Bulletin feed -->
                        <Widget IsVisible="@ShowingBulletin" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                          <Children>
                            <Widget DataSource="{BulletinFeed}" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="500" HorizontalAlignment="Center">
                              <Children>
                                <ScrollablePanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="20" MarginBottom="20" AutoHideScrollBars="true">
                                  <Children>
                                    <!-- News list -->
                                    <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" DataSource="{NewsItems}" StackLayout.LayoutMethod="VerticalTopToBottom">
                                      <ItemTemplate>
                                        <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginBottom="12">
                                          <Children>
                                            <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="Encyclopedia.SubPage.Element">
                                              <Children>
                                                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom" MarginLeft="12" MarginTop="8" MarginRight="12" MarginBottom="8">
                                                  <Children>
                                                    <RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="TownManagement.Description.Title.Text" Brush.FontSize="17" Text="@Title" MarginBottom="5" />
                                                    <RichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@Description" />
                                                  </Children>
                                                </ListPanel>
                                              </Children>
                                            </BrushWidget>
                                          </Children>
                                        </Widget>
                                      </ItemTemplate>
                                    </ListPanel>
                                  </Children>
                                </ScrollablePanel>
                              </Children>
                            </Widget>
                          </Children>
                        </Widget>

                        <!-- Activities list -->
                        <Widget IsVisible="@ShowingActivities" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                          <Children>
                            <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="6" Brush="TownManagement.Item.Title.Text" Brush.FontColor="#f4e1c4ff" Brush.FontSize="32" Text="@TitleText" ClipContents="false" />
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="600" SuggestedHeight="7" HorizontalAlignment="Center" MarginTop="46" Sprite="SPGeneral\TownManagement\title_divider" />

                            <!-- Circular activity icons (TownManagement-like grid) -->
                            <ScrollablePanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="50" MarginLeft="20" MarginRight="20" MarginBottom="20" AutoHideScrollBars="true" ClipRect="ActScrollingRect" InnerPanel="ActScrollingRect\ActivityGrid" MouseScrollAxis="Vertical">
                              <Children>
                                <Widget Id="ActScrollingRect" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
                                  <Children>
                                    <NavigatableGridWidget Id="ActivityGrid" DataSource="{CurrentLocationActivities}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" DefaultCellWidth="180" DefaultCellHeight="170" ColumnCount="4" LayoutImp.VerticalLayoutMethod="TopToBottom" StepSize="10">
                                      <ItemTemplate>
                                        <ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Command.Click="ExecuteSelect" IsEnabled="@IsAvailable" IsSelected="@IsSelected" UpdateChildrenStates="true">
                                          <Children>
                                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="140" SuggestedHeight="140" HorizontalAlignment="Center" VerticalAlignment="Top">
                                              <Children>
                                                <!-- Ring background with cold selected glow (matches native "daily default" selection feel) -->
                                                <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="TownManagement.Daily.Project.Ring" DoNotAcceptEvents="true" IsEnabled="@IsAvailable" />

                                                <!-- Icon sprite -->
                                                <ImageWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="52" SuggestedHeight="52" HorizontalAlignment="Center" VerticalAlignment="Center" MarginBottom="14" Sprite="@IconPath" AlphaFactor="@AvailabilityAlpha" />

                                                <!-- Short name + energy -->
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Bottom" MarginBottom="26" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="@ActivityShortName" AlphaFactor="@AvailabilityAlpha" />
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" VerticalAlignment="Bottom" MarginBottom="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@DurationText" AlphaFactor="@AvailabilityAlpha" />
                                              </Children>
                                            </Widget>
                                          </Children>
                                        </ButtonWidget>
                                      </ItemTemplate>
                                    </NavigatableGridWidget>
                                  </Children>
                                </Widget>
                              </Children>
                            </ScrollablePanel>
                          </Children>
                        </Widget>

                        <!-- Lance view -->
                        <Widget IsVisible="@ShowingLance" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                          <Children>
                            <Widget DataSource="{LanceLocation}" WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="500" HorizontalAlignment="Center">
                              <Children>
                                <ScrollablePanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="20" MarginBottom="20" AutoHideScrollBars="true">
                                  <Children>
                                    <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom">
                                      <Children>
                                        <!-- Lance header centered -->
                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginBottom="4" Brush="TownManagement.Item.Title.Text" Brush.FontSize="19" Text="@LanceNameText" />
                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginBottom="20" Brush="TownManagement.Description.Value.Text" Brush.FontSize="15" Text="@TierText" />

                                        <!-- Single column layout for simplicity -->
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="8" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="Lance Roster" />
                                        <ListPanel DataSource="{LanceMembers}" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom" MarginBottom="20">
                                          <ItemTemplate>
                                            <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@Name" />
                                          </ItemTemplate>
                                        </ListPanel>

                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="8" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="Current Duties" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@CurrentActivityText" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="20" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@NextActivityText" />

                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="8" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="Lance Needs" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@ReadinessText" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@EquipmentText" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@MoraleText" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@RestText" />
                                        <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginBottom="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="14" Text="@SuppliesText" />
                                      </Children>
                                    </ListPanel>
                                  </Children>
                                </ScrollablePanel>
                              </Children>
                            </Widget>
                          </Children>
                        </Widget>
                      </Children>
                    </Widget>

                    <!-- RIGHT PANEL: Details + Queue (TownManagement-like) -->
                    <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="450" HorizontalAlignment="Right">
                      <Children>
                        <!-- Use a single horizontal stack so divider/details/queue can never overlap -->
                        <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" StackLayout.LayoutMethod="HorizontalLeftToRight">
                          <Children>
                            <!-- Left divider for the right panel (native separator line) -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="!Top.VerticalDivider.Width" VerticalAlignment="Center" Sprite="SPGeneral\TownManagement\vertical_divider" AlphaFactor="0.5" />

                            <!-- Details column -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="360">
                              <Children>
                                <!-- Vertical stack: Header -> Content (Incoming Pay now in top tier, not here) -->
                                <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" StackLayout.LayoutMethod="VerticalTopToBottom">
                                  <Children>
                                    <!-- Section header (Status/Details) -->
                                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="8">
                                      <Children>
                                        <ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" StackLayout.LayoutMethod="VerticalTopToBottom">
                                          <Children>
                                            <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Item.Title.Text" Text="Status" Brush.FontColor="#f4e1c4ff" IsVisible="@ShowingBulletin" />
                                            <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Item.Title.Text" Text="Lance Info" Brush.FontColor="#f4e1c4ff" IsVisible="@ShowingLance" />
                                            <TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Item.Title.Text" Text="Details" Brush.FontColor="#f4e1c4ff" IsVisible="@ShowingActivities" />
                                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="341" SuggestedHeight="7" HorizontalAlignment="Center" Sprite="SPGeneral\TownManagement\title_divider" />
                                          </Children>
                                        </ListPanel>
                                      </Children>
                                    </Widget>

                                    <!-- Content area (fills the remaining height) -->
                                    <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginTop="6">
                                      <Children>
                                        <!-- Bulletin mode -->
                                        <Widget IsVisible="@ShowingBulletin" DataSource="{PlayerStatus}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                                          <Children>
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.Description.Title.Text" Brush.FontSize="18" Text="@PlayerNameRankText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="42" MarginLeft="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@FatigueText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="70" MarginLeft="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@HeatText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="98" MarginLeft="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@FoodText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="126" MarginLeft="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@ReputationText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="154" MarginLeft="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@PayOwedText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="190" MarginLeft="10" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="@CurrentTimeFullText" />
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" MarginTop="216" MarginLeft="10" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="@CurrentLocationText" />
                                          </Children>
                                        </Widget>

                                        <!-- Activities mode -->
                                        <Widget IsVisible="@ShowingActivities" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                                          <Children>
                                            <Widget IsVisible="@HasSelectedActivity" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" MarginLeft="10" MarginRight="10" MarginBottom="70">
                                              <Children>
                                                <Widget DataSource="{SelectedActivity}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                                                  <Children>
                                                    <ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalTopToBottom">
                                                      <Children>
                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" Brush="TownManagement.ProjectPopup.Name.Text" Brush.FontSize="22" Text="@ActivityTitle" />

                                                        <Widget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="193" SuggestedHeight="193" HorizontalAlignment="Center" MarginTop="12">
                                                          <Children>
                                                            <BrushWidget SuggestedWidth="193" SuggestedHeight="193" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="TownManagement.CurrentProject.DefaultBackground" />
                                                            <ImageWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="96" SuggestedHeight="96" HorizontalAlignment="Center" VerticalAlignment="Center" Sprite="@IconSprite" />
                                                          </Children>
                                                        </Widget>

                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="10" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@ActivityDescription" />

                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="10" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="@EnergyAvailableText" />
                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="4" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="@EnergyCostText" />

                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="12" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="Rewards" />
                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@RewardsText" />

                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="12" Brush="TownManagement.Description.Title.Text" Brush.FontSize="16" Text="Costs" />
                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="4" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="@CostsText" />
                                                      </Children>
                                                    </ListPanel>
                                                  </Children>
                                                </Widget>
                                              </Children>
                                            </Widget>

                                            <Widget IsVisible="@HasSelectedActivity" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="56" VerticalAlignment="Bottom" MarginLeft="10" MarginRight="10" MarginBottom="10">
                                              <Children>
                                                <ButtonWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Command.Click="ExecutePerformActivity" DoNotPassEventsToChildren="true">
                                                  <Children>
                                                    <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Button.ItemCard.Primary" DoNotAcceptEvents="true">
                                                      <Children>
                                                        <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="Popup.Button.ItemCard.Primary.Text" Brush.FontSize="20" Text="Perform Activity" />
                                                      </Children>
                                                    </BrushWidget>
                                                  </Children>
                                                </ButtonWidget>
                                              </Children>
                                            </Widget>

                                            <Widget IsVisible="@HasNoSelectedActivity" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="18" MarginLeft="10" MarginRight="10">
                                              <Children>
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" Brush="TownManagement.Description.Value.Text" Brush.FontSize="16" Text="Select an activity to see details." />
                                              </Children>
                                            </Widget>
                                          </Children>
                                        </Widget>
                                      </Children>
                                    </Widget>
                                  </Children>
                                </ListPanel>
                              </Children>
                            </Widget>

                            <!-- Queue column (right-most, inside the right panel like native) -->
                            <Widget WidthSizePolicy="Fixed" HeightSizePolicy="StretchToParent" SuggestedWidth="90">
                              <Children>
                                <Widget DataSource="{DailySchedule}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent">
                                  <Children>
                                    <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="10" Brush="TownManagement.Description.Title.Text" Brush.FontSize="20" Text="@HeaderText" />
                                    <ListPanel DataSource="{Items}" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="30" HorizontalAlignment="Center" StackLayout.LayoutMethod="VerticalTopToBottom">
                                      <ItemTemplate>
                                        <Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="75" MarginBottom="6">
                                          <Children>
                                            <!-- Ring with time text -->
                                            <BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="56" SuggestedHeight="56" HorizontalAlignment="Center" Brush="TownManagement.Project.Ring">
                                              <Children>
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="TownManagement.Queue.Index.Text" Brush.FontSize="15" Text="@TimeText" />
                                              </Children>
                                            </BrushWidget>
                                            <!-- Task name below ring -->
                                            <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="58" HorizontalAlignment="Center" Brush="TownManagement.Queue.Index.Text" Brush.FontSize="13" Text="@TaskText" />
                                            <!-- Active indicator (glow effect) -->
                                            <Widget IsVisible="@IsActive" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="64" SuggestedHeight="64" HorizontalAlignment="Center" VerticalAlignment="Top" MarginTop="-4">
                                              <Children>
                                                <BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="TownManagement.Project.Ring" Brush.GlobalAlphaFactor="0.6" Brush.ColorFactor="#FFD700" />
                                              </Children>
                                            </Widget>
                                            <!-- Completed indicator (checkmark overlay) -->
                                            <Widget IsVisible="@IsCompleted" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="20" SuggestedHeight="20" HorizontalAlignment="Right" VerticalAlignment="Top" MarginTop="2" MarginRight="8">
                                              <Children>
                                                <TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Brush="TownManagement.Queue.Index.Text" Brush.FontSize="16" Brush.ColorFactor="#00FF00" Text="" />
                                              </Children>
                                            </Widget>
                                          </Children>
                                        </Widget>
                                      </ItemTemplate>
                                    </ListPanel>
                                  </Children>
                                </Widget>
                              </Children>
                            </Widget>
                          </Children>
                        </ListPanel>
                      </Children>
                    </Widget>
                  </Children>
                </ListPanel>
                <!-- Close BOTTOM TIER ListPanel -->

              </Children>
            </Widget>
            <!-- Close BOTTOM TIER Widget -->

            </Children>
          </ListPanel>
          <!-- Close MAIN CONTENT AREA ListPanel -->

        </Children>
      </Widget>
      <!-- Close InnerPanel -->

          </Children>
        </BrushWidget>
        <!-- Close popup frame -->
      </Children>
    </Widget>
  </Window>
</Prefab>

